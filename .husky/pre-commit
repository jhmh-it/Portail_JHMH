#!/bin/bash

echo "ğŸ” Running pre-commit checks..."

# VÃ©rifier les fichiers sensibles
echo "ğŸ”’ Checking for sensitive files..."
if git diff --cached --name-only | grep -E "(\.env|\.env\.local|\.env\.production|firebase-admin.*\.json|serviceAccount.*\.json)$"; then
  echo "âŒ ERROR: Attempting to commit sensitive files!"
  echo "ğŸš« Please remove .env files and service account keys from your commit"
  exit 1
fi

# DÃ©tection basique de secrets
echo "ğŸ” Scanning for potential secrets..."
STAGED_FILES=$(git diff --cached --name-only)
for file in $STAGED_FILES; do
  if [ -f "$file" ]; then
    # VÃ©rifier les patterns de secrets courants
    if grep -E "(PRIVATE_KEY|SECRET|PASSWORD|API_KEY|private_key|secret|password|api_key)(\s)*[:=](\s)*[\"\'][^\"\']+[\"\']" "$file" 2>/dev/null | grep -v "process\.env\." | grep -v "NEXT_PUBLIC_"; then
      echo "âŒ ERROR: Potential secret detected in $file"
      echo "ğŸš« Please use environment variables for sensitive data"
      exit 1
    fi
  fi
done

# ExÃ©cuter lint-staged
echo "âœ… Running lint-staged..."
npx lint-staged

echo "âœ… Pre-commit checks passed!"
