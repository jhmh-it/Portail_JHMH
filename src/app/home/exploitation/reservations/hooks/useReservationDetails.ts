import { useQuery } from '@tanstack/react-query';

import { fetchReservationDetails } from '../services/reservation-details.service';
import type { ReservationDetailsQueryParams } from '../types/reservation-details';

export interface UseReservationDetailsParams {
  confirmationCode: string;
  queryParams?: ReservationDetailsQueryParams;
}

export function useReservationDetails({
  confirmationCode,
  queryParams,
}: UseReservationDetailsParams) {
  const query = useQuery({
    queryKey: ['reservation-details', confirmationCode, queryParams],
    queryFn: () => fetchReservationDetails(confirmationCode, queryParams),
    enabled: !!confirmationCode,
    staleTime: 5 * 60 * 1000, // 5 minutes
  });

  return {
    reservation: query.data?.success ? query.data.data : null,
    isLoading: query.isLoading,
    isError: query.isError || query.data?.success === false,
    error:
      query.error ??
      (query.data?.success === false ? { message: query.data.error } : null),
    refetch: query.refetch,
  };
}
